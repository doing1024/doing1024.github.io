<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>doing的小破屋</title>
        <link rel="stylesheet" href="https://unpkg.com/github-markdown-css@5.6.1/github-markdown-light.css">
        <style>
         a {
             text-decoration: none;
             color: hsl(204,90%,45%);
         }
        </style>
    </head>
    <body style="background-color: hsl(204,60%,96%);">
        <div style="background-color: hsl(204, 60%, 96%);position: fixed;width: 100vw;height: 10vh;left: 0;top: 0;z-index:999;"><a href="https://doing1024.us.kg" style="text-decoration: none;">
            <h1 style="color: hsl(204, 90%, 45%);">doing的小破屋</h1></a></div>
        <div style="background-color: hsl(204, 60%, 96%);position: absolute;top: 10vh;"><p>今天太闲得慌了！开发一个简易的Markdown编辑器吧！</p>
<h1 id="准备工作">准备工作</h1>
<p>你需要： 1. 一台电脑💻 2. 一个浏览器🛜 3. 一个可以打<code>html</code>
+ <code>javascript</code> + <code>css</code>的代码编辑器，也可以是IDE 4.
一颗学习钻研的心</p>
<p>如果以上都准备好了，那么就让我们开始吧！读完本文你将可以获得这样的效果：
<img src="https://img.doing1024.us.kg/file/65d3500a4138520662153.png"
alt="效果图" /></p>
<h1 id="编辑栏">编辑栏</h1>
<p>首先我们要实现左边写Markdown源码的部件。</p>
<p>这让我们联想到一个很常见的通用功能：编辑代码。这种需求肯定有轮子🛞可以用的，这里我使用CodeMirror。</p>
<h2 id="引入轮子">引入轮子</h2>
<p>首先我们引入它的css，在<code>&lt;head&gt;</code>和<code>&lt;/head&gt;</code>之间添加如下代码：</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--codemirror主文件--&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;https://unpkg.com/codemirror@5.40.0/lib/codemirror.css&quot;</span><span class="dt">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--xq-light主题--&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;https://unpkg.com/codemirror@5.40.0/theme/xq-light.css&quot;</span><span class="dt">&gt;</span></span></code></pre></div>
<p>如果<code>unpkg.com</code>访问过慢可以自行更换其他cdn（强烈🧱不推荐🙅jsdelivr，太慢了）</p>
<p>接下来引入它的js，将以下代码添加到<code>&lt;/body&gt;</code>以后：</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--codemirror主文件--&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://unpkg.com/codemirror@5.40.0/lib/codemirror.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--markdown代码高亮支持--&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://unpkg.com/codemirror@5.40.0/mode/markdown/markdown.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<h2 id="具体实现">具体实现</h2>
<p>首先我们在<code>&lt;body&gt;</code>和<code>&lt;/body&gt;</code>中新建一个空的<code>textarea</code>，里面可以写初始文字，但是为了以后的可拓展性，我们在这里暂时不设置文字：</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">textarea</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;edit&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">textarea</span><span class="dt">&gt;</span></span></code></pre></div>
<p>接下来我们编写页面的js，我们将所有的javascript统一写入<code>script.js</code>：</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> editor <span class="op">=</span> CodeMirror<span class="op">.</span><span class="fu">fromTextArea</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;edit&quot;</span>)<span class="op">,</span>{ <span class="co">// 新建一个CodeMirror实例</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">lineNumbers</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// 启用行号</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mode</span><span class="op">:</span> <span class="st">&quot;markdown&quot;</span><span class="op">,</span> <span class="co">// Markdown语法高亮</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">theme</span><span class="op">:</span> <span class="st">&quot;xq-light&quot;</span> <span class="co">// xq-light主题</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> text <span class="op">=</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="vs">`任何你想在初始显示的文字，</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="vs">可以多行`</span><span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>editor<span class="op">.</span><span class="fu">setValue</span>(text)<span class="op">;</span> <span class="co">// 设置初始文本为text</span></span></code></pre></div>
<p>然后在<code>index.html</code>中引入<code>script.js</code>文件，在<code>&lt;/html&gt;</code>之前写入以下内容（注意一定要写在其他script标签以后）：</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--导入javascript--&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;script.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>紧接着我们要把编辑栏设为在左侧占一半的空间，以便给后边的预览窗口留空间，将以下代码写入<code>style.css</code>:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.CodeMirror</span>{</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">top</span>: <span class="dv">0</span><span class="dt">vh</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">left</span>: <span class="dv">0</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">position</span>: <span class="dv">fixed</span><span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">width</span>: <span class="dv">50</span><span class="dt">vw</span><span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">height</span>: <span class="dv">100</span><span class="dt">vh</span><span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>最后我们要在<code>index.html</code>中引入<code>style.css</code>，将其写入<code>&lt;head&gt;</code>与<code>&lt;/head&gt;</code>之间:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--引入css--&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;style.css&quot;</span><span class="dt">&gt;</span> </span></code></pre></div>
<p>现在你可以尝试用浏览器打开<code>index.html</code>看看效果了，大概应该长酱紫：
<img src="https://img.doing1024.us.kg/file/d9073eb28363d8ab4a541.png"
alt="效果图1" /></p>
<h1 id="预览栏">预览栏</h1>
<p>接下来我们要实现右侧的预览窗口。</p>
<h2 id="导入轮子">导入轮子🛞</h2>
<p>首先我们导入css，在<code>&lt;head&gt;</code>和<code>&lt;/head&gt;</code>之间写入如下内容：</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--导入github-markdown样式--&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;https://unpkg.com/github-markdown-css@5.6.1/github-markdown-light.css&quot;</span><span class="dt">&gt;</span></span></code></pre></div>
<p>还有js，写到<code>&lt;/body&gt;</code>以后：</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--showdown是一个将markdown转为html的库--&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://unpkg.com/showdown@2.1.0/dist/showdown.min.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<h2 id="实现">实现</h2>
<p>首先新建一个<code>div</code>来“盛”预览的内容：</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- class=&quot;markdown-body&quot;是为了让github-markdown识别到它 --&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;show&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&#39;markdown-body&#39;</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p>然后我们写js:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> converter <span class="op">=</span> <span class="kw">new</span> showdown<span class="op">.</span><span class="fu">Converter</span>({ <span class="co">// 新建showdown转换器</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tables</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// 支持表格</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extensions</span><span class="op">:</span> [</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showdownKatex</span>({ <span class="co">// 支持Latex公式</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">throwOnError</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// 公式有错时，是否抛出错误</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">displayMode</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="co">// 如果为false，公式以inline方式渲染</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">delimiters</span><span class="op">:</span> [</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                { <span class="dt">left</span><span class="op">:</span> <span class="st">&#39;$$&#39;</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="st">&#39;$$&#39;</span><span class="op">,</span> <span class="dt">display</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                { <span class="dt">left</span><span class="op">:</span> <span class="st">&#39;$&#39;</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="st">&#39;$&#39;</span><span class="op">,</span> <span class="dt">display</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                { <span class="dt">left</span><span class="op">:</span> <span class="st">&#39;~&#39;</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="st">&#39;~&#39;</span><span class="op">,</span> <span class="dt">display</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">asciimath</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            ]<span class="op">,</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> showbar <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;show&#39;</span>)<span class="op">;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>editor<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;change&#39;</span><span class="op">,</span> (codemirrorIns<span class="op">,</span> codemirrorObj) <span class="kw">=&gt;</span> { <span class="co">// 改变时的事件</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    showbar<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> converter<span class="op">.</span><span class="fu">makeHtml</span>(editor<span class="op">.</span><span class="fu">getValue</span>())<span class="op">;</span> <span class="co">// 重新生成html填入showbar</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">// 以上内容要写在editor.setValue(text)以前</span></span></code></pre></div>
<p>最后写css：</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#show</span>{</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">width</span>: <span class="dv">50</span><span class="dt">vw</span><span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">height</span>: <span class="dv">100</span><span class="dt">vh</span><span class="op">;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">position</span>: <span class="dv">fixed</span><span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">top</span>: <span class="dv">0</span><span class="dt">vh</span><span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">right</span>: <span class="dv">0</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">overflow</span>:<span class="bu">auto</span><span class="op">;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">.katex-html</span>{</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>现在你就可以达到文章开头时的效果图啦！自己运行试试吧！</p>
<p>更多效果和功能尽请期待下一篇：<a
href="./make-markdown-edit2.md">从零开始带你做Markdown编辑器（二）：深色主题</a></p>
</div>
    </body>
</html>
