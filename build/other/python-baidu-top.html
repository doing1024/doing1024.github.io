<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta charset="utf-8">
        <title>doing的小破屋</title>
        <style>
	 table { border-color:#111111; border-collapse: collapse;}
         img {
             width: 90vw;
             z-index: 1000;
         }
         .pstbdy{
             width: 100vw;
             flex: auto;
         }
         body{
             display: flex;
             flex-direction: column;
         }
         @media screen and (max-width: 750px){
             body{
		 font-size: 5vw !important;
             }
         }
	 /* Sspai Web Theme A theme to [sspai](ssp.ai) default theme. Developed by Codegass(wchweichenhao@gmial.com) & Yves(yves@sspai.com) Download Cuto on the App Store and Google Play! */
	 body {
	     font-size: 15px;
	     color:#333;
	     background:#fff;
	     font-family: Helvetica, Arial, "PingFang SC", "Microsoft YaHei", "WenQuanYi Micro Hei", "tohoma,sans-serif";
	     margin: 0;
	 }
	 h1 {
	     font-size: 2.2em;
	     font-weight: 700;
	     line-height: 1.1;
	     padding-top: 16px;
	     margin-bottom: 4px;
	 }
	 h2, h3, h4, h5, h6 {
	     line-height: 1.5em;
	     margin-top: 2.2em;
	     margin-bottom: 4px;
	 }
	 h2 {
	     font-size: 1.4em;
	     margin: 40px 10px 20px 0;
	     padding-left: 9px;
	     border-left: 6px solid #ff7e79;
	     font-weight: 700;
	     line-height: 1.4;
	 }
	 h3 {
	     font-weight: 700;
	     font-size: 1.2em;
	     line-height: 1.4;
	     margin: 10px 0 5px;
	     padding-top: 10px;
	 }
	 h4 {
	     font-weight: 700;
	     text-transform: uppercase;
	     font-size: 1.1em;
	     line-height: 1.4;
	     margin: 10px 0 5px;
	     padding-top: 10px
	 }
	 h5, h6 {
	     font-size: .9em;
	 }
	 h5 {
	     font-weight: bold;
	     text-transform: uppercase;
	 }
	 h6 {
	     font-weight: normal;
	     color: #AAA;
	 }
	 img {
	     width: 100%;
	     border-radius: 5px;
	     display: block;
	     margin-bottom: 15px;
	     height: auto;
	 }
	 dl,ol,ul {
	     margin-top: 12px;
	     margin-bottom: 20px;
	     padding-left: 5%;
	     line-height: 1.8;
	 }
	 p {
	     margin: 0 0 20px;
	     padding: 0;
	     line-height: 1.8;
	 }
	 a {
	     text-decoration: none;
	     color: black;
	     border-bottom: 1px solid #d71a1b;
	 }
	 a:focus {
	     outline-offset: -2px;
	 }
	 blockquote {
	     font-size: 1em;
	     font-style: normal;
	     padding: 30px 38px;
	     margin: 0 0 15px;
	     position: relative;
	     line-height: 1.8;
	     text-indent: 0;
	     border: none;
	     color: #888;
	 }
	 blockquote:before {
	     content: "“";
	     left: 12px;
	     top: 0;
	     color: #E0E0E0;
	     font-size: 4em;
	     font-family: Arial, serif;
	     line-height: 1em;
	     font-weight: 700;
	     position: absolute;
	 }
	 blockquote:after {
	     content: "”";
	     right: 12px;
	     bottom: -26px;
	     color: #E0E0E0;
	     font-size: 4em;
	     font-family: Arial, serif;
	     line-height: 1em;
	     font-weight: 700;
	     position: absolute;
	     bottom: -31px;
	 }
	 strong, dfn {
	     font-weight: 700;
	 }
	 em, dfn {
	     font-style: italic;
	     font-weight: 400;
	 }
	 del {
	     text-decoration: line-through;
	 }
	 /*code {font-size:90%;}*/
	 /*pre {text-align:left; overflow-x: scroll; color: #257fa0; background: #f6f6f6; padding: 10pt 15pt; border-radius: 3px; border: solid 1px #e2e2e2;}*/
	 pre {
	     margin: 0 0 10px;
	     font-size: 13px;
	     line-height: 1.42857;
	     word-break: break-all;
	     word-wrap: break-word;
	     border-radius: 4px;
	     white-space: pre-wrap;
	     display: block;
	     background: #f8f8f8;
	     padding: 10px 20px;
	     border: none;
	     margin-bottom: 25px;
	     color: #666;
	     font-family: Courier, sans-serif;
	 }
	 code {
	     color: #c7254e;
	     background-color: #f9f2f4;
	     border-radius: 4px;
	     font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
	     padding: 2px 4px;
	     font-size: 90%;
	 }
	 p > code {
	     color: #c7264e;
	     background-color: #f9f2f4;
	     font-size: .95em;
	     border-radius: 3px;
	     -moz-border-radius: 3px;
	     -webkit-border-radius: 3px;
	 }
	 figure {
	     margin: 1em 0;
	 }
	 figcaption {
	     font-size: 0.75em;
	     padding:0.5em 2em;
	     margin-bottom: 2em;
	 }
	 figure img {
	     margin-bottom: 0px;
	 }
	 hr {
	     margin-top: 20px;
	     margin-bottom: 20px;
	     border: 0;
	     border-top: 1px solid #eee;
	 }
	 ol p, ul p {
	     margin-bottom: 0px;
	 }
	 li {
	     margin-bottom: 0.75em;
	     margin-top: 0.75em;
	 }
	 ol#footnotes {
	     font-size: 0.95em;
	     padding-top: 1em;
	     margin-top: 1em;
	     margin-left: 0;
	     border-top: 1px solid #eaeaea;
	     counter-reset: footer-counter;
	     list-style: none;
	     color: #555;
	     padding-left: 5%;
	     margin: 20px 0;
	 }
	 ol#footnotes li {
	     margin-bottom: 10px;
	     margin-left: 16px;
	     font-weight: 400;
	     line-height: 2;
	     list-style-type: none;
	 }
	 ol#footnotes li:before {
	     content: counter(footer-counter) ". ";
	     counter-increment: footer-counter;
	     font-weight: 800;
	     font-size: .95em;
	 }
	 @keyframes highfade {
	     0% {background-color: none;}
	     20% {background-color: yellow;}
	     100% {background-color: none;}
	 }
	 @-webkit-keyframes highfade {
	     0% {background-color: none;} 
	     20% {background-color: yellow;}
	     100% {background-color: none;}
	 }
	 a:target, ol#footnotes li:target, sup a:target {
	     animation-name: highfade;
	     animation-duration: 2s;
	     animation-iteration-count: 1;
	     animation-timing-function: ease-in-out;
	     -webkit-animation-name: highfade;
	     -webkit-animation-duration: 2s;
	     -webkit-animation-iteration-count: 1;
	     -webkit-animation-timing-function: ease-in-out;
	 }
	 a:target {
	     border:0;
	     outline: 0;
	     animation-iteration-count: 1;
	     -webkit-animation-timing-function: ease-in-out;
	 }
	 a:target {
	     border:0;
	     outline: 0;
	     tion-iteration-count: 1;
	     -webkit-animation-timing-function: ease-in-out;
	 }
	 a:target {
	     border:0;outline: 0;
	 }
	</style>
	<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/atom-one-dark.min.css">
    </head>
    <body>
        <div style="z-index:999;flex-shrink: 0;"><a href="https://doing1024.us.kg/" style="text-decoration: none;color: black;display:flex;flex-direction: row;flex-warp: nowarp;justify-content: flex-start;">
            <h1>doing的小破屋</h1></a></div>
        <div class="pstbdy"><p>闲来无事，play
python，今天准备搞个百度热搜榜爬虫玩玩，记录下开发过程。 <img
src="https://img.doing1024.us.kg/file/5817633a2489dbdfe2415.jpg"
alt="爬虫" /></p>
<h1 id="准备工作">准备工作</h1>
<p>首先需要安装轮子🛞，在终端运行如下代码（假如你已经将python添加到path）</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> pip install requests beautifulsoup4 lxml</span></code></pre></div>
<p>PS:
如果是<code>MacOS</code>/<code>Linux</code>则将<code>python</code>替换为<code>python3</code>.</p>
<h1 id="获得网页内容">获得网页内容</h1>
<p>首先我们导入刚才安装好的<code>requests</code>来获得网页内容。</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span></code></pre></div>
<p>然后就可以开始获取内容了。</p>
<p>百度热搜榜的网址：<a
href="https://top.baidu.com/board?tab=realtime">https://top.baidu.com/board?tab=realtime</a></p>
<p>代码：</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">&quot;https://top.baidu.com/board?tab=realtime&quot;</span>  <span class="co"># 指定百度热搜榜网址</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url) <span class="co"># 向url发送GET请求</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>content <span class="op">=</span> response.text <span class="co"># 获得html内容</span></span></code></pre></div>
<p>怎么样？第一部分是不是很简单？接下来我们来处理这些获得到的内容。</p>
<h1 id="处理内容">处理内容</h1>
<p>首先还是导入轮子🛞：</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup <span class="im">as</span> bs</span></code></pre></div>
<p>然后我们要定义一个解析器<code>soup</code>：</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> bs(content, <span class="st">&quot;lxml&quot;</span>) <span class="co"># 定义解析器，内容为刚才获得的html，引擎使用lxml</span></span></code></pre></div>
<p>接下来我们需要 ”观察“ 热搜榜网页，寻找规律。</p>
<p>首先用浏览器打开百度热搜榜网址，然后右键 -&gt;
检查，你就会看到侧面（下面）有一堆代码，这就是刚才<code>content</code>里面内容的来源了。然后我们按<code>Ctrl + Shift + C</code>，这时你会发现鼠标在网页的任何地方浮动，都会有地方变色，这时，我们控制鼠标，让第一条热搜变色，像这样：
<img src="https://img.doing1024.us.kg/file/1d64741823b585660a9c4.png"
alt="这样" /></p>
<p>这时我们注意右侧的一堆代码，发现有一个<code>&lt;div class="category-wrap_iQLoo horizontal_1eKyQ"&gt; ... &lt;/div&gt;</code>被的背景变成了浅蓝色，这就是我们刚才选中的那条热搜对应的代码，这里简单科普一下<code>html</code>，让你能看懂刚才那段东西。</p>
<blockquote>
<p>在html中，所有“组件”被称为“元素”，<code>&lt;div&gt;</code>表示div元素的开始，<code>&lt;/div&gt;</code>表示这个元素的结束，就像括号一样，两两匹配。<code>&lt;div somethings&gt; ... &lt;/div&gt;</code>中somethings的位置填写这个元素的设置，像姓啥、名啥、小名是啥、多少岁啦、男的女的都在这里面配置。<code>...</code>的位置是元素里面的内容，两个眼睛一个鼻子一个嘴巴两个耳朵什么的…😄</p>
</blockquote>
<p>现在回到刚才的<code>&lt;div class="category-wrap_iQLoo horizontal_1eKyQ"&gt; ... &lt;/div&gt;</code>，我们发现背景高亮的这一行下面还有很多一模一样的。再来看他的属性<code>class</code>，你可以把它理解为这些元素“所属的班级”，他们可以身处不同位置，通过班级名字把他们召唤到一起😅。一个元素可以身处很多班级，一个班级也可以有很多人，一个人所属的班级在<code>class</code>属性中以空格隔开。既然所有热搜的班级都一样，只要找这个班级里的所有元素，就是所有的热搜条目了。</p>
<p>在<code>python</code>中我们可以这样实现：</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>top_list <span class="op">=</span> soup.find_all(<span class="st">&quot;div&quot;</span>,attrs<span class="op">=</span>{<span class="st">&quot;class&quot;</span>: <span class="st">&quot;category-wrap_iQLoo&quot;</span>})</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 详细解释：soup.find_all 返回一个类似于列表的object,div指必须为div元素，attrs为筛选条件，网页中的class被空格分开了，我们选其中一个就可以了。</span></span></code></pre></div>
<p>回到百度热搜网页，还是看刚才选中的背景高亮的代码，点击代码左侧小三角展开代码，继续不停展开，像这样（由于屏幕大小原因，我折叠了一部分无关内容，你可以全部展开）：
<img
src="https://img.doing1024.us.kg/file/6db2cbfd97f0242f80d85.png" /></p>
<p>我们主要需要两条信息：标题和热搜指数（排名可以通过循环变量递增获得）。通过观察可得，热搜指数在<code>class</code>为<code>hot-index_1Bl1a</code>的元素中，标题的<code>class</code>则为<code>c-single-text-ellipsis</code>，根据这些信息，我们就可以获取到所需数据了，参考代码：</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(top_list)):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    top <span class="op">=</span> top_list[i]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> top.find_all(<span class="st">&quot;div&quot;</span>,attrs <span class="op">=</span> {<span class="st">&quot;class&quot;</span>: <span class="st">&quot;c-single-text-ellipsis&quot;</span>}).get_text().strip()  <span class="co"># get_text用于获取元素中的文本，strip用于去掉头尾空格</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    hotindex <span class="op">=</span> top.find_all(<span class="st">&quot;div&quot;</span>, attrs <span class="op">=</span> {<span class="st">&quot;class&quot;</span>: <span class="st">&quot;hot-index_1Bl1a&quot;</span>})[<span class="dv">0</span>].get_text().strip() <span class="co"># 同上</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;第</span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">名，标题：</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">，热搜指数：</span><span class="sc">{</span>hotindex<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<p>现在运行代码就可以获得所有热搜啦！</p>
<h1 id="附生成表格的简单方法">附：生成表格的简单方法</h1>
<p>有的同学可能想生成表格，这里简单提供一个方法：</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;baidutop.csv&quot;</span>,mode<span class="op">=</span><span class="st">&quot;w&quot;</span>) <span class="im">as</span> f: <span class="co"># csv文件也是一种表格文件，可以用excel直接打开</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;列1,列2,列3&quot;</span>,<span class="bu">file</span><span class="op">=</span>f) <span class="co"># csv文件每行的列用英文逗号分开，按照这样的原则替换刚才的代码即可。</span></span></code></pre></div>
</div>
	<script src="https://giscus.app/client.js"
		data-repo="doing1024/doing1024.github.io"
		data-repo-id="R_kgDOMZDXwQ"
		data-category="Q&A"
		data-category-id="DIC_kwDOMZDXwc4Ci8x6"
		data-mapping="pathname"
		data-strict="0"
		data-reactions-enabled="1"
		data-emit-metadata="0"
		data-input-position="top"
		data-theme="light"
		data-lang="zh-CN"
		data-loading="lazy"
		crossorigin="anonymous"
		async>
	</script>
        <script>
         var lst = document.getElementsByTagName("img");
         for (var i = 0;i < lst.length;++i) lst[i].setAttribute("data-zoomable","");
         document.addEventListener('DOMContentLoaded', function () {
             mediumZoom('[data-zoomable]');
         });
        </script>
    </body>
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://unpkg.com/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script>
</html>
